<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<style type="text/css">
			.aui-counter-box {
				width: 100%;
				padding: 0;
				line-height: 26px;
			}
			.aui-nav {
				background: #ff9900;
				font-size: 18px;
				color: #fff;
				text-align: center;
			}
			.aui-nav  div {
				height: 55px;
			}
			.aui-nav .buy {
				line-height: 55px;
			}
			.blue {
				background: #fff;
			}
			.blue .aui-iconfont, .blue p {
				color: #999;
			}
			.buy {
				background: #FF9800;
			}
			.aui-input-row:first-child:after {
				border-top: 0px solid #c8c7cc;
			}
			.aui-input-row .aui-input-addon {
				width: auto;
			}
			.aui-input-row:last-child:after {
				border-bottom: 0px solid #000;
			}
			.heji {
				font-size: 14px;
				vertical-align: middle;
				white-space: nowrap;
				line-height: 55px;
			}
			.font-color {
				color: #E74C3C;
			}
			.aui-nnav{line-height:40px;}
				.demo{font-size:15px;color: red;background:#fff;}
		.buy{ background:white;
		    color: red;
		    font-weight:bold }
		</style>
	</head>
	<body>
		<div class="aui-content">
			<script id="car_ordertpl" type="text/x-dot-template" >
				<ul class="aui-list-view">
				{{for(var i in it) { }}
				<li class="aui-list-view-cell aui-img aui-counter-list" tapmode onclick="">
				<div class="aui-img-body">
				<div class="aui-counter-box">
				<div class="aui-pull-left" id="orderName" style="color:#E74C3C;font-size:15px;">
				<b>种类：{{=it[i].classname}}</b>
				</div>
				<div class="aui-text-default aui-pull-sright" id="orderamount"style="padding-left:15px">
				</div>
				<br />
				<div class="aui-pull-left" id="orderCash2">
				{{ for(var prop in it[i].order) { }}
				<div style="font-size:14px; padding-left: 15px">菜名：{{= it[i].order[prop].name}}</div>
				<div style="font-size:14px; padding-left: 15px">单价：{{= it[i].order[prop].price}}/斤</div>
				<div style="font-size:14px; padding-left: 15px">数量：{{= it[i].order[prop].amount}}</div>
				<div style="font-size:14px; padding-left: 15px">总价：{{= it[i].order[prop].money}}</div><br/>
				{{ } }}
				</div>
				<div class="aui-line-x" style="margin: 17px 0 8px 0;"></div>
				<div ><!--具体要求：{{=it[i].orderRequest}}-->
				{{? it[i].orderRequest }}
				具体要求：<em>{{=it[i].orderRequest}}</em>
				{{??}}
				具体要求：<em>无</em>
				{{?}}
				</div>
				<div class="aui-line-x" style="margin: 17px 0 8px 0;"></div>
				<p class="aui-text-right" style="color:#6ab494;font-size:17px;padding-right: 20px">总金额：{{=it[i].money}}元</p>
				<div class="aui-line-x" style="margin: 8px 0 5px 0;"></div>
				
				<div class="aui-col-xs-12 aui-text-center aui-nnav">
				    <div class="aui-col-xs-8 demo">未完成支付</div>
				    <div class="aui-col-xs-4 buy" tapmode onclick="checkOut('{{=it[i].id}}')">结算</div>
			    </div>
				
				<!--<button style="margin-left: 75%; color: red; font-size: 14px" onclick="checkOut('{{=it[i].id}}')">结算</button>-->
				<div class="aui-line-x" style="margin: 17px 0 8px 0;"></div>
				</div>
				</div>
				</li>
				{{ } }}
				</ul>
			</script>
			<!--<div id="orderinclude"></div>-->
			<div class="aui-list-view" id="car_include"></div>
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/zepto.min.js"></script>
	<script type="text/javascript" src="../script/echo.min.js"></script>
	<script type="text/javascript" src="../script/common.js"></script>
	<script type="text/javascript" src="../script/doT.min.js"></script>
	<script type="text/javascript">
		var model;
		var query;
		function openoder() {
			api.openWin({
				name : 'enter_order_detail_head',
				url : './enter_order_detail_head.html'
			});
		}

		apiready = function() {
			model = api.require('model');
			query = api.require('query');
			model.config({
				appKey : '7810E5E4-7F54-E1E6-B07F-9ADA6FA49D46',
				host : 'https://d.apicloud.com'
			});
			api.parseTapmode();
			initframe();
			api.setRefreshHeaderInfo({
				visible : true,
				loadingImg : '../image/refresh.png',
				bgColor : '#ccc',
				textColor : '#fff',
				textDown : '下拉刷新...',
				textUp : '松开刷新...',
				showTime : true
			}, function(ret, err) {
				//在这里从服务器加载数据，加载完成后调用api.refreshHeaderLoadDone()方法恢复组件到默认状态
				initframe()
				api.refreshHeaderLoadDone();
			});
		}
		function checkOut(id) {
			model.updateById({
				class : 'orderForm',
				id : id,
				value : {
					checkOut : true
				}
			}, function(ret, err) {
				//coding...
				if (ret) {
					api.alert({
						msg : "结算成功"
					}, function(ret, err) {
						//coding...
					});
				}
			});
		}

		function initframe() {
			var userid = $api.getStorage('uid');
			userid = '"' + userid + '"';
			if (userid == null) {
				api.alert({
					msg : "亲，要先登录哦~"
				}, function(ret, err) {
					if (ret) {
						api.closeToWin({
							name : 'root'
						});
					}
				});
				return;
			}
			api.showProgress({
				title : '正在查找...',
				modal : false
			});
			query.createQuery({
			}, function(ret, err) {
				if (ret && ret.qid) {
					query.whereEqual({
						qid : ret.qid,
						column : 'userid',
						value : userid
					});
					model.findAll({
						class : 'orderForm',
						qid : ret.qid
					}, function(ret, err) {
						if (ret) {
							var include = $api.byId('car_include');
							var tpl = $api.byId('car_ordertpl').text;
							var tempFn = doT.template(tpl);
							include.innerHTML = tempFn(ret);
						}
					});
				}
			});
			api.hideProgress();
		}
	</script>
</html>